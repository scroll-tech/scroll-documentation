---
section: developers
date: Last Modified
title: "پیام‌رسان Scroll"
lang: "fa"
permalink: "developers/l1-and-l2-bridging/the-scroll-messenger"
whatsnext: { "هزینه‌های تراکنش در Scroll": "/fa/developers/transaction-fees-on-scroll/" }
excerpt: "مستندات پیام‌رسان Scroll برای ارسال پیام‌های دلخواه بین L1 و L2."
---

import Aside from "../../../../../components/Aside.astro"

قراردادهای پیام‌رسان Scroll امکان ارسال پیام‌های دلخواه از L1 به L2 یا بالعکس را فراهم می‌کنند. این امکان به شما اجازه می‌دهد تا توابع را در زنجیره دیگر به‌صورت ایمن و بدون نیاز به مجوز اجرا کنید. برای ارسال پیام از L1 به L2، از قرارداد پیام‌رسان مستقر شده در L1، یعنی `L1ScrollMessenger` استفاده کنید. برای ارسال پیام از L2 به L1، از قرارداد مستقر شده در L2، یعنی `L2ScrollMessenger` استفاده کنید.

<Aside type="caution" title="">
  هنگام ارسال تراکنش از طریق **پیام‌رسان Scroll** که در L1 و L2 مستقر است، فرستنده تراکنش (یعنی `CALLER` یا `msg.sender`) آدرس قرارداد پیام‌رسان است که در زنجیره دریافت‌کننده مستقر شده است.
  <br />
  در نسخه‌های آینده Scroll، تراکنش‌های اجباری از L1 به شما این امکان را می‌دهند که فرستنده در L2 را به عنوان EOA اصلی در L1 تنظیم کنید. همچنین این امکان را فراهم می‌کند که اشخاص ثالث به‌طور ایمن تراکنش‌های امضا شده را انتقال دهند.
</Aside>

## نهایی‌سازی تراکنش‌ها در L1

تراکنش‌های آینده از L2 نیاز به نهایی‌سازی از طریق تابع `relayMessageWithProof` در قرارداد پیام‌رسان Scroll دارند. این فرآیند "ارسال تراکنش برداشت" نامیده می‌شود و برای ارسال پیام‌های دلخواه و انتقال دارایی‌ها از طریق گیت‌وی یا روتر ضروری است. هنگام استفاده از `relayMessageWithProof`، باید یک مدرک گنجایش Merkle ارائه دهید که نشان‌دهنده گنجاندن تراکنش شما در درخت "برداشت" پیام‌ها باشد، به همراه سایر پارامترها. تولید این مدرک و مقادیر مربوطه می‌تواند به‌صورت محلی و بدون نیاز به مجوز انجام شود، اما در حال حاضر، ساده‌ترین راه برای دریافت این پارامترها از طریق APIهای پشتیبان ما است:

- API Scroll Sepolia: https://sepolia-api-bridge-v2.scroll.io/api/
- API Scroll: https://mainnet-api-bridge-v2.scroll.io/api/

<Aside type="danger" title="API آزمایشی">
  این API برای رابط کاربری بریج ما ایجاد شده است. هنوز نهایی نشده و ممکن است در آینده تغییر کند. ما این راهنما را زمانی که API نهایی شد به‌روزرسانی خواهیم کرد. علاوه بر این، تمام نمونه‌های زیر از سرویس API Sepolia استفاده می‌کنند -- درخواست‌ها باید به راحتی برای کار در مین نت تطبیق داده شوند.
</Aside>

آدرس EOA یا قراردادی را که مسئول آغاز تراکنش اصلی در L2 است به نقطه پایانی `/claimable` ارسال کنید. API پشتیبان تمام اطلاعات لازم برای نهایی‌سازی موفقیت‌آمیز تراکنش در L1 را به شما ارائه خواهد داد. به مثال زیر نگاهی بیندازید:

```bash
https://sepolia-api-bridge.scroll.io/api/claimable?address=0x031407eaaffFB4f1EC2c999bE4477E52C81de3c5&page_size=10&page=1
```

API باید داده‌های تراکنش شما را به شکل زیر بازگرداند:

```json
{
  "errcode": 0,
  "errmsg": "",
  "data": {
    "result": [
      {
        "hash": "0xa476850306d6ee52b127628ded34dcf2343570873cce9c5383bd497db48d4f9b",
        "amount": "",
        "to": "",
        "isL1": false,
        "l1Token": "",
        "l2Token": "",
        "blockNumber": 748,
        "blockTimestamp": null,
        "finalizeTx": {
          "hash": "",
          "amount": "",
          "to": "",
          "isL1": false,
          "blockNumber": 0,
          "blockTimestamp": null
        },
        "claimInfo": {
          "from": "0x031407eaaffFB4f1EC2c999bE4477E52C81de3c5",
          "to": "0x1039057185CFe192d16c03F5656225821A193FD5",
          "value": "0",
          "nonce": "9",
          "batch_hash": "0x49a18d72dbceeb957f918947b532db452c031f528e7e6bf329007066638c5e50",
          "message": "0xa413686200000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000005686f6c6973000000000000000000000000000000000000000000000000000000",
          "proof": "0x69b4ee6cf9a38bed79668ddd347fef2bdff44c3760c9309fa41decfd60202d22ad3228b676f7d3cd4284a5443f17f1962b36e491b30a40b2405849e597ba5fb5b4c11951957c6f8f642c4af61cd6b24640fec6dc7fc607ee8206a99e92410d3079f53171df5c0661d2afe86c4d97b6f34278daf6a0ea9baff5b4fc979d5629a5",
          "batch_index": "93"
        },
        "createdTime": null
      }
    ],
    "total": 1
  }
}
```

شیء `claimInfo` در زیر JSON `result` تمامی اطلاعات لازم برای اجرای تراکنش شما در L1 را دارد. پارامترهای لازم برای `relayMessageWithProof` شامل: `from`, `to`, `value`, `nonce`, `message` و `proof` هستند. این‌ها را به تابع `relayMessageWithProof` در L1 ارائه دهید تا تراکنش خود را اجرا و نهایی کنید.

<Aside type="tip" title="">
  تمامی تراکنش‌های L2 به صورت گروهی جمع‌آوری می‌شوند – باید صبر کنید تا گروهی که شامل تراکنش شما است نهایی شود قبل از اینکه `relayMessageWithProof` را فراخوانی کنید. شاخص گروه تراکنش شما در مقدار `batch_index` در نقطه پایانی `/claimable` بازگردانده می‌شود و می‌توانید پیشرفت آن را در [کاوشگر Scroll Rollup](https://scroll.io/rollupscan?page=1&per_page=10) پیگیری کنید.
</Aside>

## API پیام‌رسان

لطفاً برای مستندات کامل API قرارداد Scroll به [کتابخانه npm](https://www.npmjs.com/package/@scroll-tech/contracts?activeTab=code) مراجعه کنید.

### sendMessage

```solidity
function sendMessage(
  address target,
  uint256 value,
  bytes calldata message,
  uint256 gasLimit,
  address refundAddress
) external payable;
```

ارسال داده‌های دلخواه از یک زنجیره به زنجیره دیگر. این امکان را فراهم می‌کند که توابع را به‌صورت بین‌زنجیره‌ای اجرا کنیم.

| پارامتر      | توضیحات                                                                                                                   |
| ------------ | ------------------------------------------------------------------------------------------------------------------------- |
| target       | آدرس حسابی که پیام را دریافت می‌کند. دریافت‌کننده می‌تواند یک قرارداد هوشمند یا یک کیف پول EOA باشد.                 |
| value        | مقدار اتر که هنگام فراخوانی قرارداد هدف ارسال می‌شود.                                                                     |
| message      | محتوای پیام. این داده دلخواهی است که باید اجرا شود.                                                                       |
| gasLimit     | محدودیت گس مورد نیاز برای تکمیل انتقال پیام در زنجیره مربوطه.                                                            |
| refundAddress| آدرس حسابی که هزینه‌های بازپرداخت به آن ارسال خواهد شد.                                                                    |

### relayMessageWithProof

```solidity
function relayMessageWithProof(
  address from,
  address to,
  uint256 value,
  uint256 nonce,
  bytes memory message,
  L2MessageProof memory proof
) external;
```

انتقال پیام از L2 به L1 با استفاده از مدرک پیام.

| پارامتر | توضیحات                                                   |
| ------- | --------------------------------------------------------- |
| from    | آدرس فرستنده پیام.                                        |
| to      | آدرس دریافت‌کننده پیام.                                   |
| value   | مقدار msg.value که به تماس پیام اضافه شده است.            |
| nonce   | نانس پیام برای جلوگیری از حملات تکراری.                   |
| message | محتوای پیام.                                              |
| proof   | مدرکی که برای تأیید صحت تراکنش استفاده می‌شود.             |
