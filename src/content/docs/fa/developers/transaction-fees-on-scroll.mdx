---
section: developers
date: Last Modified
title: "کارمزد های تراکنش در Scroll"
lang: "fa"
permalink: "developers/transaction-fees-on-scroll/"
whatsnext: { "ابزارهای Deploy در Scroll": "/fa/developers/tooling-deployed-on-scroll" }
excerpt: "آشنایی با نحوه عملکرد هزینه‌های تراکنش در Scroll."
---

import Aside from "../../../../components/Aside.astro"

## بررسی اجمالی

هزینه‌های تراکنش در Scroll به‌طور قابل توجهی کمتر از لایه پشتیبانی‌کننده آن است. برای کاربران و توسعه‌دهندگان، هزینه‌های تراکنش در Scroll به‌طور مشابه با هزینه‌های در مین نت اتریوم به نظر می‌رسد و ابزارها، کیف پول‌ها و کدهای موجود احتمالاً به‌طور مشابه عمل خواهند کرد. با این حال، هزینه تراکنش نشان داده شده در کیف پول تصویر کاملی از هزینه‌ها نیست مگر اینکه نرم‌افزار به‌طور خاص از محاسبات هزینه‌های Scroll آگاه باشد.

به دلیل طراحی رول‌آپ‌های L2، هزینه‌های تراکنش به هزینه‌های L1 وابسته است. برای بهره‌برداری از امنیت اتریوم، Scroll باید هزینه داده‌های تراکنش و اثبات‌هایی که باید در L1 ذخیره و تأیید شوند را در نظر بگیرد.

در مقایسه با مین نت اتریوم، Scroll ابعاد جدیدی به محاسبه هزینه تراکنش اضافه می‌کند. هزینه نهایی یک تراکنش از چندین بخش تشکیل شده است:

- **هزینه L2**
  - به همان شیوه‌ای که در L1 محاسبه می‌شود، برابر با `gas_price * gas_used`
- **هزینه L1**
  - این هزینه اضافی برای ارسال داده‌ها به L1 جهت در دسترس بودن داده‌ها است. تراکنش‌هایی که از L1 آغاز می‌شوند این هزینه را پرداخت نمی‌کنند.
  - بر اساس اندازه داده‌های کالادای تراکنش محاسبه می‌شود.
  - ETH به‌طور خودکار از موجودی کاربر در Scroll برای پرداخت هزینه کسر می‌شود.

به‌طور خلاصه، **هزینه L2** هزینه اجرای تراکنش شما در ترتیب‌دهنده L2 است و **هزینه L1** هزینه ثبت آن تراکنش در L1 است.

به عبارت دیگر، `totalTxFee = l2Fee + l1Fee`، که همه به ETH، توکن گس بومی شبکه Scroll، اندازه‌گیری می‌شود.

<Aside type="note" title="هزینه‌های تراکنش به کجا می‌روند؟">
تمام هزینه‌های تراکنش به موجودی قرارداد `L2ScrollFeeVault` جمع‌آوری می‌شود. این قرارداد همچنین مقدار برداشت‌های تاریخی به L1 را با استفاده از `totalProcessed()(uint256)` پیگیری می‌کند.

تولیدکننده بلوک هیچ پاداش مستقیمی دریافت نمی‌کند و کد عملیات `COINBASE` آدرس خزانه هزینه را برمی‌گرداند.

</Aside>

## هزینه L2

تراکنش‌ها در Scroll، مشابه اتریوم، باید هزینه اجرای محاسبات و ذخیره داده‌هایی که تولید می‌کنند را پرداخت کنند.

### محاسبه هزینه اجرای

هزینه اجرای L2 به‌طور مستقیم به صورت زیر محاسبه می‌شود:

```javascript
l2TransactionExecutionFee = l2TransactionGasUsed * l2TransactionGasPrice
```

هزینه کل بستگی به کاری که تراکنش انجام می‌دهد (`l2TransactionGasUsed`) و شرایط فعلی بازار (`l2TransactionGasPrice`) دارد. کاربران قیمت گس را تعیین می‌کنند و "گس استفاده شده" با فراخوانی نقطه پایانی `estimateGas` در یک نود Scroll ارزیابی می‌شود.

به عبارت دیگر، هزینه اجرا دقیقاً مانند اتریوم قبل از [EIP1559](https://eips.ethereum.org/EIPS/eip-1559) محاسبه می‌شود.

## هزینه L1

هر تراکنش باید داده‌های کالادای آن به اتریوم ارسال شود که هزینه اضافی به نام "هزینه L1" را به همراه دارد. بدون انجام این کار، Scroll نمی‌تواند از داده‌های L1 بازسازی شود.

تراکنش‌ها به‌صورت یک‌به‌یک ثبت نمی‌شوند بلکه در دسته‌های بلوک (و بلوک‌های تراکنش) جمع‌آوری می‌شوند. هزینه یک تراکنش فردی بر اساس صفرها و بایت‌های غیرصفر در بارگذاری آن محاسبه می‌شود.

### تخمین هزینه داده‌های L1

Scroll دارای یک `L1GasPriceOracle` از پیش مستقر شده در آدرس `0x5300000000000000000000000000000000000002` است که در هر دو [Scroll Mainnet](https://scrollscan.com/address/0x5300000000000000000000000000000000000002) و [Scroll Sepolia](https://sepolia.scrollscan.com/address/0x5300000000000000000000000000000000000002) در دسترس است. این اوراکل متدی به نام `getL1Fee` برای تخمین هزینه داده‌های L1 برای داده‌های خام یک تراکنش فراهم می‌آورد.

```solidity
function getL1Fee(bytes memory _data) external view override returns (uint256);
```

<Aside type="note" title="چه اتفاقی می‌افتد اگر قیمت گس در L1 افزایش یابد؟">

پس از پردازش تراکنش توسط ترتیب‌دهنده، هزینه L1 کاربر قفل می‌شود و نوسانات قیمت تأثیری بر آنچه کاربر پرداخت می‌کند نخواهد داشت.

<br />
به دلیل زمان‌های کوتاه بلوک در Scroll، تغییرات قیمت گس L1 بین ارسال تراکنش و گنجاندن آن در بلوک باید حداقل باشد. ترتیب‌دهنده هرگونه تغییر در هزینه‌های گس L1 بین گنجاندن تراکنش در بلوک و زمانی که ترتیب‌دهنده داده‌ها را به L1 ارسال می‌کند، جذب خواهد کرد.

</Aside>

### محاسبه هزینه داده‌های L1 با استفاده از اوراکل گس

همان‌طور که ذکر شد، `L1GasPriceOracle` برای تخمین هزینه گس L1 بر اساس داده‌های خام تراکنش استفاده می‌شود. این اوراکل **پوش** است که توسط یک ریلیور اجرا شده توسط Scroll به‌روزرسانی می‌شود.

هزینه داده‌ها بر اساس چندین عامل محاسبه می‌شود:

- بایت‌هایی که صفر و غیرصفر از یک تراکنش رمزگذاری شده با RLP هستند.
- `l1BaseFee` - هزینه پایه فعلی در L1
- `overhead` - هزینه اضافی گس برای یک تراکنش تعهد داده
- `scalingFactor` - عامل مقیاس‌گذاری برای حساب کردن افزایش قیمت
- `PRECISION` - یک ثابت برای مقیاس‌گذاری هزینه نهایی

مراحل محاسبه هزینه داده‌های L1 به شرح زیر است:

1. سه فیلد `l1BaseFee`, `overhead`, `scalar` را از قرارداد `L1GasPriceOracle` بخوانید. مکان‌های این فیلدها در قرارداد به شرح زیر است:

   | فیلد        | مکان |
   | ----------- | ---- |
   | l1BaseFee   | 1    |
   | overhead    | 2    |
   | scalar      | 3    |

2. تعداد بایت‌های صفر و غیرصفر از تراکنش را شمارش کنید.
3. هزینه داده‌های L1 را با توجه به `TX_DATA_ZERO_GAS = 4` و `TX_DATA_NON_ZERO_GAS = 16`[^eip-2028] و `PRECISION = 1e9` محاسبه کنید:

   ```javascript
   l1Gas = zeros * TX_DATA_ZERO_GAS + (nonzeros + 4) * TX_DATA_NON_ZERO_GAS
   l1GasFee = ((l1Gas + overhead) * l1BaseFee * scalar) / PRECISION
   ```

   ما 4 بایت اضافی را برای بایت‌های غیرصفر رزرو می‌کنیم تا تعداد بایت‌ها در تراکنش رمزگذاری شده با RLP ذخیره شود.

[^eip-2028]: برای اطلاعات بیشتر به [EIP-2028](https://eips.ethereum.org/EIPS/eip-2028) مراجعه کنید.

### API L1GasPriceOracle

#### overhead

```solidity
function overhead() external view returns (uint256);
```

مقدار اضافی هزینه L1 را باز می‌گرداند.

#### scalar

```solidity
function scalar() external view returns (uint256);
```

مقدار مقیاس‌گذاری هزینه L1 را باز می‌گرداند.

#### l1BaseFee

```solidity
function l1BaseFee() external view returns (uint256);
```

آخرین هزینه پایه L1 را باز می‌گرداند.

#### getL1Fee

```solidity
function getL1Fee(bytes memory data) external view returns (uint256);
```

بخش L1 هزینه را بر اساس اندازه تراکنش رمزگذاری شده RLP، هزینه پایه L1 فعلی و پارامترهای پویا محاسبه می‌کند.

**برمی‌گرداند:** هزینه L1 که باید برای تراکنش پرداخت شود.

| پارامتر | توضیحات                                                 |
| ------- | ------------------------------------------------------- |
| data    | تراکنش کاملاً رمزگذاری شده RLP که هزینه L1 آن محاسبه می

‌شود. |

#### getL1GasUsed

```solidity
function getL1GasUsed(bytes memory data) external view returns (uint256);
```

مقدار گس L1 مورد استفاده برای یک تراکنش را محاسبه می‌کند. اضافه می‌کند 74 بایت پدینگ برای حساب کردن این که ورودی دارای امضا نیست.

**برمی‌گرداند:** مقدار گس L1 مورد استفاده برای انتشار تراکنش.

| پارامتر | توضیحات                                                 |
| ------- | ------------------------------------------------------- |
| data    | تراکنش کاملاً رمزگذاری شده RLP که هزینه L1 آن محاسبه می‌شود. |

## تراکنش‌های منشأ گرفته از L1

هنگام پیام‌رسانی از L1 به L2، کاربر تمام هزینه‌های تراکنش را در L1 پرداخت می‌کند. کاربر هزینه‌های گس L1 را پرداخت می‌کند، اما به دلیل این، نیازی به پرداخت هزینه داده‌های L1 به Scroll ندارد. اما آنها باید هزینه‌های اجرای L2 را در تراکنش L1 خود محاسبه کنند و باید بدانند که چقدر گس L2 پرداخت کنند.

قراردادها در L1 می‌توانند از یک اوراکل قیمت گس L2 مستقر شده در L1 برای دریافت هزینه گس برای یک تراکنش استفاده کنند. اوراکل همچنین هزینه پایه L2 و هزینه پیام‌گذاری میان دامنه‌ای را برای یک محدودیت گس معین ارائه می‌دهد.

در مین نت، `L2GasPriceOracle` در آدرس [`0x987e300fDfb06093859358522a79098848C33852`](https://etherscan.io/address/0x987e300fDfb06093859358522a79098848C33852) مستقر است.

در Sepolia، باید از `L1MessageQueueWithGasPriceOracle` ارتقا یافته استفاده شود که در آدرس [`0xF0B2293F5D834eAe920c6974D50957A1732de763`](https://sepolia.etherscan.io/address/0xF0B2293F5D834eAe920c6974D50957A1732de763) مستقر است.

اگر سیستم شما از مکانیزم‌های غیرآنچین پشتیبانی می‌کند، همچنین می‌توانید از `eth_estimateGas` و `eth_gasPrice` در هر نود RPC Scroll برای دریافت تخمینی از گس مورد نیاز برای یک تراکنش استفاده کنید.

<Aside type="danger" title="اطلاعیه به‌روزرسانی">
پس از به‌روزرسانی بریج فوریه 2024، `L2GasPriceOracle` به نفع `L1MessageQueueWithGasPriceOracle` منسوخ خواهد شد، که در آدرس [`0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B`](https://etherscan.io/address/0x0d7E906BD9cAFa154b048cFa766Cc1E54E39AF9B) در دسترس خواهد بود.

این به‌روزرسانی انتظار می‌رود تا 21 فوریه 2024 نهایی شود، پس از یک دوره قفل دو هفته‌ای. Scroll Sepolia این به‌روزرسانی را از پیش انجام داده است. برای اطلاعات بیشتر [اینجا](https://scroll.io/blog/protocol-upgrade-bridging-cost-reduction) بخوانید.

</Aside>
{/* TODO: Add full documentation of key methods */}

## نقشه راه آینده

در حال حاضر، محاسبات مورد نیاز برای تولید اثبات و گس برای تأیید اثبات در L1 به‌وسیله Scroll و شرکای اثبات‌کننده مختلف یارانه داده می‌شود. این هزینه‌ها به‌طور جزئی با تعیین حداقل قیمت گس L2 پوشش داده می‌شود.

با غیرمتمرکز شدن شبکه اثبات‌کننده، انگیزه‌های تولید اثبات باید به پروتکل وارد شوند تا سیستم پایدار و مقیاس‌پذیر باشد.

انتظار می‌رود که هزینه نهایی گس به‌طور صریح شامل هزینه تولید این اثبات‌ها شود. با بهینه‌سازی‌های بیشتر پروتکل، این هزینه برای کاربر باید حداقل باشد، زیرا هر اثبات بسیاری از تراکنش‌ها را پوشش می‌دهد.
