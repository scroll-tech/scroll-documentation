---
section: technology
date: Last Modified
title: "نود اجرایی"
lang: "fa"
permalink: "technology/sequencer/execution-node"
whatsnext: { "نود Rollup": "/fa/technology/sequencer/rollup-node/" }
---

import Aside from "../../../../../components/Aside.astro"

نود اجرایییکی از اجزای اصلی پروتکل Scroll است: مسئول نگهداری از بلاک‌چین L2 می‌باشد. نود اجراییهمچنین اطمینان حاصل می‌کند که تجربه کاربری و توسعه‌دهنده در Scroll به طور نزدیکی به آنچه در Ethereum است، شباهت داشته باشد. این کار را با حفظ رفتار EVM و RPC که مستقیماً از Ethereum به ارث برده شده است، با تغییرات بسیار کم، به انجام می‌رساند.

عملکردهای اصلی نود اجراییدر Scroll عبارتند از:
- جمع‌آوری تراکنش‌ها از L2 و L1.
- اعتبارسنجی تراکنش‌ها و بسته‌بندی آنها در بلاک‌های L2.
- اجرای بلاک‌ها و نگهداری از وضعیت بلاک‌چین L2.

قابل توجه است که پیام‌ها و توکن‌های پل‌زده از L1 به L2 (سپرده‌ها) نیز به عهده نود اجراییاست. از طرف دیگر، پیام‌ها از L2 به L1 (برداشت‌ها) می‌توانند توسط هر کاربری در L1 اجراییشوند.

عملکردهای ثانویه نود اجراییدر Scroll عبارتند از:
- ارائه API‌های استاندارد Ethereum و برخی از API‌های افزونه Scroll.
- اجازه دادن به همتایان (نود‌های پیرو) برای همگام‌سازی بلاک‌چین با استفاده از پروتکل همتا به همتای Ethereum.

نود اجراییکه یک نسخه از [go-ethereum](https://github.com/ethereum/go-ethereum) است، بیشتر عملکردهای خود را از Ethereum به ارث برده است. این شامل ساختارهای داده تراکنش و بلاک، اجرای EVM، پروتکل‌های RPC و p2p است. از آنجایی که اینها مجدداً پیاده‌سازی نشده‌اند و مستقیماً از `go-ethereum` به ارث برده شده‌اند، می‌توانیم با اطمینان بسیار بالا از سازگاری Scroll با Ethereum اطمینان داشته باشیم.

بخش‌های بعدی اجزای اصلی نود اجرا، قوانین اعتبارسنجی اضافی و خلاصه‌ای از جزئیات تغییرات را معرفی خواهند کرد.

## اجزای `l2geth`

[`l2geth`](https://github.com/scroll-tech/go-ethereum) نسخه Scroll از [go-ethereum](https://github.com/ethereum/go-ethereum) است. این مسئول ساخت و اجرای بلاک‌ها و نگهداری از وضعیت بلاک‌چین است. `l2geth` بیشتر عملکردهای خود را از Ethereum به ارث برده است، با برخی تفاوت‌های قابل توجه که در زیر فهرست شده‌اند. `l2geth` شامل زیرماژول‌های زیر است (فهرست جامع نیست):
- **ذخیره‌سازی**: ذخیره‌سازی دفتر کل و وضعیت با استفاده از LevelDB پیاده‌سازی شده است.
- **EVM**: قوانین انتقال وضعیت Ethereum.
- **کارگر**: مسئول ایجاد بلاک‌های جدید L2.
- **خدمات همگام‌سازی L1**: همگام‌سازی و ذخیره پیام‌های L1 در پایگاه داده محلی `l2geth`.
- **لایه API**: رابط‌های RPC و p2p استاندارد Ethereum.
- **پول تراکنش**: Mempool برای تراکنش‌های L2.
- **بازرسان ظرفیت مدار**: بررسی می‌کند که آیا یک تراکنش یا بلاک از حد ظرفیت مدار فراتر می‌رود یا خیر.

### بازرسان ظرفیت مدار

با مدارهای zkEVM فعلی Scroll، ممکن است تراکنش‌ها و بلاک‌هایی بسازید که نمی‌توان آنها را اثبات کرد زیرا در مدار zkEVM جا نمی‌شوند. این را *سرریز اثبات* می‌نامیم. برای جلوگیری از این امر، ما ماژول *بازرسان ظرفیت مدار* را به عنوان بخشی از l2geth پیاده‌سازی کرده‌ایم. بازرسان ظرفیت مدار هم در هنگام ایجاد بلاک و هم در هنگام اعتبارسنجی بلاک استفاده می‌شود.

در حین ایجاد بلاک، اگر تراکنش بعدی به سرریز اثبات منجر شود، ما بلاک را مهر و موم کرده و تراکنش را برای بلاک بعدی می‌گذاریم. اگر یک تراکنش منفرد باعث سرریز اثبات شود، l2geth آن را کنار می‌گذارد. این مکانیزم را *رد کردن* می‌نامیم.

رد کردن تراکنش‌های L2 به سادگی به معنای کنار گذاشتن آنها است. در این صورت، کاربر باید تراکنش دیگری با همان nonce که به سرریز اثبات منجر نمی‌شود، ارسال کند تا ادامه یابد.

رد کردن پیام‌های L1 فرآیند صریح‌تری است. هم قرارداد `ScrollChain` در L1 و هم zkEVM تأیید می‌کنند که هر تراکنش L1 در `L1MessageQueue` یا شامل و اجراییشده است، یا کنار گذاشته شده است. در حالی که کدگذاری دسته‌ای شامل تراکنش‌های L1 نیست، اما شامل یک *نقشه پرش* است که به `ScrollChain` نشان می‌دهد کدام پیام‌های L1 کنار گذاشته شده‌اند. اگر یک پیام سپرده L1 کنار گذاشته شود، کاربر می‌تواند توکن‌های خود را در L1 پس بگیرد.

<Aside type="note" title="یادداشت">
  {" "}
  سرریز اثبات و در نتیجه کنار گذاشتن نشان‌دهنده فعالیت مخرب است؛ برای تراکنش‌های سپرده عادی، این هرگز اتفاق نخواهد افتاد.
  {" "}
</Aside>

از آنجایی که واحد اثبات zkEVM، بخش است، باید از سرریز اثبات برای بخش‌ها نیز جلوگیری کرد.
این با گنجاندن بازرسان ظرفیت مدار در رول‌آپ‌ریلییر حاصل می‌شود تا اطمینان حاصل شود که هرگز بخش‌هایی که نمی‌توان آنها را اثبات کرد، پیشنهاد نمی‌شوند.

## قوانین اعتبارسنجی

Scroll چند قانون اعتبارسنجی اضافی به قوانین اعتبارسنجی بلاک‌های Ethereum اضافه می‌کند. این قوانین جدید رفتار L2 در مورد گنجاندن پیام‌های L1 و محدودیت ظرفیت مدار zkEVM را محدود می‌کنند.
- ماژول [بازرسان ظرفیت مدار](#circuit-capacity-checker) که در بالا توضیح داده شد، اعتبارسنجی می‌کند که آیا بلاک می‌تواند در ظرفیت فضای مدار zkEVM جا بگیرد یا خیر.
- قوانین مربوط به پیام‌های L1:
    - پیام‌های L1 در یک بلاک باید متوالی و در ابتدای بلاک باشند.
    - پیام‌های L1 در یک بلاک باید طبق ترتیب آنها در `L1MessageQueue` گنجانده شوند، یعنی آنها باید با افزایش `QueueIndex` گنجانده شوند.
    - پیام‌های L1 در یک بلاک باید با آنهایی که در قرارداد `L1MessageQueue` هستند، مطابقت داشته باشند.
- اکثر این قوانین در هنگام ایجاد بلاک و اعتبارسنجی بلاک در نظر گرفته می‌شوند. به همین دلیل، اگر نود پیشنهادی بلاک هر یک از این قوانین را نقض کند، نود‌های پیرو بلاک‌های آن را رد خواهند کرد.

## خلاصه تغییرات

نود اجراییدر Scroll بیشتر رفتارهای Ethereum را به ارث برده است. با این حال، برای فعال‌سازی اثبات مؤثرتر، ما مجبور شدیم تغییرات شکاف‌زا را در `l2geth` ایجاد کنیم. این بخش فهرستی غیرجامع از تغییرات و دلایل آنها را ارائه می‌دهد.

- **درخت وضعیت و ذخیره‌سازی**: Ethereum از MPT (Merkle-Patricia Trie) به عنوان ساختار داده‌های وضعیت و ذخیره‌سازی قرارداد استفاده می‌کند. ساختار این درخت و این واقعیت که از هش Keccak استفاده می‌کند، باعث می‌شود که برای مدارهای ZK به شدت گران‌قیمت باشد. `l2geth` به جای آن از [zkTrie](/technology/sequencer/zktrie): یک درخت مرکل دودویی با هش Poseidon برای وضعیت و ذخیره‌سازی قرارداد استفاده می‌کند.
- **حساب‌های وضعیت**: تغییرات حساب وضعیت در [حساب‌ها و وضعیت](/technology/chain/accounts) توصیف شده است.
- **EVM**: تغییرات در [تفاوت‌های EVM با Ethereum](/technology/chain/differences) توصیف شده است.
- **هزینه‌های تراکنش**
    - تمام هزینه‌های جمع‌آوری‌شده در L2 به یک قرارداد خزانه هزینه L2 که توسط Scroll نگهداری می‌شود، ارسال می‌شود.
    - هزینه L1: علاوه بر هزینه گس L2 که هزینه‌های فضای بلاک و اجرای بلاک L2 را پوشش می‌دهد، ما همچنین هزینه L1 را جمع‌آوری می‌کنیم که هزینه‌های متعهد کردن تراکنش به L1 را پوشش می‌دهد. این هزینه به اندازه تراکنش کدگذاری شده به صورت RLP متناسب است. هزینه واقعی بستگی به تنظیمات فعلی ذخیره شده در قرارداد `L1GasOracle` در L

2 دارد. این هزینه مستقیماً از موجودی فرستنده کسر می‌شود (و نه از مجوز گس).
- **L1MessageTx**: ما نوع تراکنش جدیدی به نام `L1MessageTx` معرفی کردیم. ما همچنین رابط‌های DB جدیدی برای ذخیره چنین تراکنش‌ها و متاداده مربوطه اضافه کردیم.
- **خدمات همگام‌سازی**: بلاک‌های نهایی‌شده در L1 را نظارت می‌کند و پیام‌های L1 را از این‌ها جمع‌آوری می‌کند.
- **API جدید**: `l2geth` یک API پیگیری `scroll_traceBlockByNumberOrHash` ارائه می‌دهد تا پرووِرها بتوانند اطلاعات پیگیری را برای تولید اثبات‌ها جستجو کنند.
