---
section: technology
date: Last Modified
title: "درگاه های واریز"
lang: "fa"
permalink: "technology/bridge/deposit-gateways"
whatsnext: { "درگاه های برداشت": "/fa/technology/bridge/withdraw-gateways/" }
---

import ClickToZoom from "../../../../../components/ClickToZoom.astro"
import DepositWorkflow from "../_images/deposit.png"

این سند نحوه استفاده کاربران و توسعه‌دهندگان از دروازه‌ها برای واریز توکن‌ها از L1 به L2 را توضیح می‌دهد. ما چندین دروازه برای توکن‌های استاندارد و یک روتر دروازه در L1 ارائه می‌دهیم که در جدول زیر فهرست شده‌اند.

| قرارداد دروازه          | توضیحات                                                        |
| ------------------------ | --------------------------------------------------------------- |
| `L1GatewayRouter`        | روتر دروازه واریز ETH و توکن‌های ERC20 را پشتیبانی می‌کند.      |
| `L1ETHGateway`           | دروازه برای واریز ETH.                                        |
| `L1StandardERC20Gateway` | دروازه برای واریز توکن‌های استاندارد ERC20.                   |
| `L1CustomERC20Gateway`   | دروازه برای واریز توکن‌های سفارشی ERC20.                     |
| `L1WETHGateway`          | دروازه برای واریز ETH Wrapped.                                |
| `L1ERC721Gateway`        | دروازه برای واریز توکن‌های ERC-721.                            |
| `L1ERC1155Gateway`       | دروازه برای واریز توکن‌های ERC-1155.                          |

## مرور کلی

<ClickToZoom src={DepositWorkflow} alt="روند واریز" />

این شکل روند واریز از L1 به L2 را به تصویر می‌کشد. کاربران با فراخوانی دروازه‌ها، واریز توکن را آغاز می‌کنند. واریز سپس به یک پیام رمزگذاری شده و به قرارداد `L1ScrollMessenger` ارسال می‌شود و یک تراکنش مربوط به L1 به صف تراکنش‌های `L1MessageQueue` اضافه می‌شود. برای نهایی‌سازی واریزها در L2، توالی‌کننده L2 رویدادهای تراکنش جدید L1 را جمع‌آوری کرده و تراکنش‌های مربوطه را در بلوک‌های L2 که ایجاد می‌کند، قرار می‌دهد. بخش‌های بعدی جزئیات نحوه واریز توکن‌های مختلف را شرح می‌دهند. شما می‌توانید جزئیات بیشتری در مورد روند ارسال پیام از L1 به L2 را در [پیام‌رسانی بین‌دامنه‌ای](/technology/bridge/cross-domain-messaging#sending-messages-from-l1-to-l2) پیدا کنید.

## واریز ETH

اسکرول ETH را به عنوان توکن بومی خود در نظر می‌گیرد. ما مقدار کافی ETH را در بلوک شروع به قرارداد `L2ScrollMessenger` اختصاص داده‌ایم تا بتواند توکن ETH بومی را به حساب‌های L2 منتقل کند بدون اینکه به صورت جداگانه ضرب شود. واریز ETH به شرح زیر است.

1. `L1GatewayRouter` سه تابع برای واریز ETH از L1 به L2 ارائه می‌دهد. تابع `depositETHAndCall` می‌تواند ETH را منتقل کند و همزمان یک تماس به قرارداد را اجرا کند.

    ```solidity
    function depositETH(uint256 _amount, uint256 _gasLimit) external payable;

    function depositETH(address _to, uint256 _amount, uint256 _gasLimit) public payable;

    function depositETHAndCall(
        address _to,
        uint256 _amount,
        bytes calldata _data,
        uint256 _gasLimit
    ) external payable;
    ```

2. هر سه تابع `depositETH` به `L1ETHGateway` فراخوانی می‌شوند. `L1ETHGateway` واریز را به یک پیام رمزگذاری شده و به قرارداد `L1ScrollMessenger` ارسال می‌کند.

3. ETH مقدار واریز در قرارداد `L1ScrollMessenger` قفل می‌شود. `L1ScrollMessenger` پیام را به صف پیام در قرارداد `L1MessageQueue` اضافه می‌کند.

4. پس از نهایی شدن تراکنش واریز در L1، توالی‌کننده تراکنش معادل را در بلوک L2 برای نهایی‌سازی واریز و انتقال ETH به آدرس گیرنده در L2 درج خواهد کرد.

5. تراکنش L2 تابع `L2ScrollMessenger.relayMessage` را فراخوانی می‌کند که پیام منتقل‌شده را اجرا می‌کند.
   در مورد واریز ETH، تابع `relayMessage` تابع `L2ETHGateway.finalizeDepositETH` را فراخوانی می‌کند تا ETH را به حساب گیرنده در L2 منتقل کند.

6. اگر کاربر تابع `depositETHAndCall` را در L1 فراخوانی کند، تابع `finalizeDepositETH` در قرارداد `L2ETHGateway` داده‌های اضافی را به قرارداد هدف L2 منتقل خواهد کرد.

## واریز توکن‌های ERC20

چندین قرارداد دروازه ERC20 برای پل‌زدن انواع مختلف توکن‌های ERC20، مانند توکن‌های استاندارد ERC20، توکن‌های سفارشی ERC20 و توکن Wrapped ETH ارائه شده است. `L1GatewayRouter` نگاشت استاندارد توکن‌های ERC20 به دروازه‌های مربوطه در L1 را ثبت می‌کند. `L1GatewayRouter` از `StandardERC20Gateway` به عنوان دروازه پیش‌فرض ERC20 برای توکن‌های جدید ERC20 استفاده می‌کند، مگر اینکه دروازه سفارشی قبلاً تنظیم شده باشد.

واریز توکن‌های ERC20 به شرح زیر است.

1. برای واریز توکن‌های ERC20 از L1 به L2، کاربران می‌توانند از `L1GatewayRouter.depositERC20` و `L1GatewayRouter.depositERC20AndCall` استفاده کنند که در زیر نشان داده شده است.

    ```solidity
    function depositERC20(address _token, uint256 _amount, uint256 _gasLimit) external payable;

    function depositERC20(address _token, address _to, uint256 _amount, uint256 _gasLimit) external payable;

    function depositERC20AndCall(
        address _token,
        address _to,
        uint256 _amount,
        bytes memory _data,
        uint256 _gasLimit
    ) public payable;
    ```

2. بر اساس نگاشت توکن‌های ERC20 به دروازه، `L1GatewayRouter` به دروازه مربوطه مانند `L1StandardERC20Gateway`، `L1CustomERC20Gateway` یا `L1WETHGateway` فراخوانی می‌کند. مراحل بعدی به طور جداگانه توضیح داده خواهد شد.

### توکن‌های استاندارد ERC20

توکن‌های استاندارد ERC20 توکن‌هایی هستند که نیاز به منطق سفارشی ندارند. برای چنین توکن‌هایی، قراردادهای توکن ERC20 در L2 توسط `L2StandardERC20Gateway` ایجاد می‌شود. مراحل باقی‌مانده برای واریز توکن ERC20 استاندارد به شرح زیر است:

3. قرارداد `L1StandardERC20Gateway` توکن‌های ERC20 را با انتقال آنها از فرستنده به خود قفل می‌کند.
4. اگر این توکن ERC20 قبلاً از طریق `L1StandardERC20Gateway` برداشت نشده باشد، `L1StandardERC20Gateway` یک آدرس توکن ERC20 در L2 به صورت قطعی محاسبه کرده و متاداده توکن (نماد، نام و دقت) را به پیام برای احتمال پیاده‌سازی قرارداد در L2 اضافه می‌کند. اگر آدرس توکن L2 قبلاً در `tokenMapping` ذخیره شده باشد، `L1StandardERC20Gateway` مستقیماً آدرس توکن L2 را از نگاشت بارگذاری می‌کند.
5. `L1StandardERC20Gateway` پیام واریز توکن را رمزگذاری کرده و به `L1ScrollMessenger` برای ارسال پیام فراخوانی می‌کند.
6. تراکنش معادل در L2 تابع `L2ScrollMessenger.relayMessage` را برای نهایی‌سازی واریز در L2 فراخوانی می‌کند. در مورد واریز توکن‌های استاندارد ERC20، تراکنش سپس تابع `L2StandardERC20Gateway.finalizeDepositERC20` را فراخوانی می‌کند.
7. اگر قرارداد توکن ERC20 در L2 هنوز پیاده‌سازی نشده باشد، `L2StandardERC20Gateway` متاداده توکن را از پیام استخراج کرده و تابع `ScrollStandardERC20Factory` را برای پیاده‌سازی توکن استاندارد ERC20 در L2 فراخوانی می‌کند.
8. `L2StandardERC20Gateway` تابع mint را روی قرارداد توکن ERC20 مربوطه در L2 فراخوانی می‌کند.
9. اگر کاربر تابع `depositERC20AndCall` را در L1 فراخوانی کند، `L2StandardERC20Gateway` قرارداد هدف L2 را با داده‌های اضافی فراخوانی خواهد کرد.

### توکن‌های سفارشی ERC20

در مقایسه با توکن‌های استاندارد ERC20، قرارداد L2 توکن‌های سفارشی ERC20 توسط مالک توکن پیاده‌سازی می‌شود. مراحل باقی‌مانده برای واریز توکن‌های ERC20 سفارشی به شرح زیر است:

3. قرارداد `L1CustomERC20Gateway` توکن‌های

 ERC20 را در L1 با انتقال آنها از فرستنده به خود قفل می‌کند.
4. `L1CustomERC20Gateway` نیاز به وجود آدرس توکن ERC20 در L2 در `tokenMapping` دارد. این آدرس ERC20 مربوطه را بازیابی کرده و پیام واریز توکن را رمزگذاری کرده و به `L1ScrollMessenger` ارسال می‌کند.
5. تراکنش معادل در L2 تابع `L2ScrollMessenger.relayMessage` را برای نهایی‌سازی واریز در L2 فراخوانی می‌کند. در مورد واریز توکن‌های ERC20 سفارشی، تراکنش تابع `L2CustomERC20Gateway.finalizeDepositERC20` را فراخوانی می‌کند.
6. `L2CustomERC20Gateway` تابع mint را روی قرارداد توکن ERC20 مربوطه در L2 فراخوانی می‌کند. لازم است که قرارداد توکن ERC20 در L2 مجوزهای mint را به قرارداد `L2CustomERC20Gateway` اعطا کند.
7. اگر کاربر تابع `depositERC20AndCall` را در L1 فراخوانی کند، `L2CustomERC20Gateway` قرارداد هدف L2 را با داده‌های اضافی فراخوانی خواهد کرد.

### توکن WETH

ما یک دروازه سفارشی `L1WETHGateway` برای توکن Wrapped ETH در L1 ارائه می‌دهیم و آدرس دروازه را در `L1GatewayRouter` ثبت می‌کنیم. واریز توکن WETH به شرح زیر است.

3. `L1WETHGateway` توکن‌های WETH را با انتقال آنها از فرستنده به خود قفل می‌کند و توکن WETH را به ETH بومی تبدیل می‌کند. سپس توکن ETH و `msg.value` (برای پرداخت هزینه انتقال) به قرارداد `L1ScrollMessenger` ارسال می‌شود.
4. `L1WETHGateway` پیام واریز توکن را رمزگذاری کرده و به `L1ScrollMessenger` ارسال می‌کند.
5. تراکنش معادل در L2 تابع `L2ScrollMessenger.relayMessage` را برای نهایی‌سازی واریز در L2 فراخوانی می‌کند. در مورد واریز توکن WETH، تراکنش تابع `L2WETHGateway.finalizeDepositERC20` را فراخوانی می‌کند.
6. `L2WETHGateway` توکن ETH واریز شده را دوباره به توکن WETH در L2 تبدیل کرده و آن را به آدرس گیرنده در L2 منتقل می‌کند.
7. اگر کاربر تابع `depositERC20AndCall` را در L1 فراخوانی کند، `L2WETHGateway` قرارداد هدف L2 را با داده‌های اضافی فراخوانی خواهد کرد.

## واریز توکن‌های ERC-721/ERC-1155

واریز توکن‌های ERC-721 یا ERC-1155 بسیار مشابه با توکن‌های ERC20 است. برای واریز توکن‌های ERC-721 /ERC-1155 از L1، می‌توان از دروازه‌های `L1ERC721Gateway` یا `L1ERC1155Gateway` استفاده کرد.

```solidity
function depositERC721(
    address _token,
    uint256 _tokenId,
    uint256 _gasLimit
) external payable;

function depositERC721(
    address _token,
    address _to,
    uint256 _tokenId,
    uint256 _gasLimit
) external payable;

function depositERC1155(
    address _token,
    uint256 _tokenId,
    uint256 _amount,
    uint256 _gasLimit
) external payable;

function depositERC1155(
    address _token,
    address _to,
    uint256 _tokenId,
    uint256 _amount,
    uint256 _gasLimit
) external payable;
```

برای تسهیل در واریز حجم زیادی از توکن‌های ERC-721 یا ERC-1155، ما همچنین توابع واریز دسته‌ای را در قراردادهای `L1ERC721Gateway` و `L1ERC1155Gateway` از طریق توابع زیر ارائه می‌دهیم:

```solidity
function batchDepositERC721(
    address _token,
    uint256[] calldata _tokenIds,
    uint256 _gasLimit
) external payable;

function batchDepositERC721(
    address _token,
    address _to,
    uint256[] calldata _tokenIds,
    uint256 _gasLimit
) external payable;

function batchDepositERC1155(
    address _token,
    uint256[] calldata _tokenIds,
    uint256[] calldata _amounts,
    uint256 _gasLimit
) external payable;

function batchDepositERC1155(
    address _token,
    address _to,
    uint256[] calldata _tokenIds,
    uint256[] calldata _amounts,
    uint256 _gasLimit
) external payable;
```

قرارداد‌های معادل L2 برای توکن‌های ERC-721 یا ERC-1155 `L2ERC721Gateway` و `L2ERC1155Gateway` هستند. این قراردادها برای نهایی‌سازی واریزها در L2 استفاده می‌شوند.